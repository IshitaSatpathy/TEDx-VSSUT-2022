<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="../../source/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer"
    />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <title>TEDx VSSUT 2022 | Ticket Status</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            font-family: 'Roboto', sans-serif;
            box-sizing: border-box;
        }
        
        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            background: #121212;
        }
        
        nav {
            position: sticky;
            top: 0;
            background: #000;
            padding: 20px 30px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid #607d8b;
        }
        
        .logo {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .fa-angle-left::before {
            color: #fff;
            font-size: 32px;
        }
        
        .content {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            width: 100%;
        }
        
        .main-content {
            width: 100%;
            height: 100%;
            max-width: 500px;
        }
        
        h2 {
            font-weight: bold;
        }
        
        .card {
            background: #000;
            padding: 16px 20px;
            width: 100%;
            border-radius: 8px;
        }
        
        .payment {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: space-between;
        }
        
        .payment #status {
            flex-grow: 1;
        }
        
        .fa-solid {
            font-size: 1.5em;
        }
        
        .fa-circle-check {
            color: #4bb543;
        }
        
        .fa-circle-xmark {
            color: #fc001d;
        }
        
        .payid-input {
            display: flex;
            padding: 20px;
            color: #000;
        }
        
        .payid-input input,
        input[type="text"]:focus {
            color: #000;
        }
        
        .payid-input button {
            background: #e62b1e;
            color: #fff;
        }
    </style>
</head>

<body>
    <nav>
        <a class="back-button">
            <i class="fa-solid fa-angle-left"></i>
        </a>
        <a href="https://tedxvssut.com" target="_blank" class="logo">
            <img src="../../assets/images/logo/logo-1l-w.svg" alt="logo" width="180">
        </a>

    </nav>
    <div class="content">
        <div class="main-content">
            <h2>Ticket Status</h2>
            <form class="payid-input card mb-3">
                <input type="text" name="payid" id="payid" placeholder="Payment ID">
                <button type="submit" class="button" id="checkbtn">Check</button>
            </form>
            <div id="payment-status" class="d-none">
                <div class="user card mb-3">
                    <p id="uname" class="m-0 text-white">Name: </p>
                    <p id="upaymentid" class="m-0">Payment ID: </p>
                </div>
                <div class="payment card">
                    <p id="status" class="p-0 m-0">Payment</p>
                    <i class="fa-solid fa-circle-check d-none" id="icon-paid"></i>
                    <i class="fa-solid fa-circle-xmark d-none" id="icon-fail"></i>
                </div>
            </div>
            <div id="error" class="text-white text-center bg-danger rounded py-2 d-none"></div>
        </div>

    </div>
    <!-- footer section start here -->
    <section class="footer-section ">
        <div class="footer-bottom px-3 " style="background-color: black; ">
            <div class="container container-1310 ">
                <div class="row justify-content-lg-between justify-content-center align-items-center ">
                    <!-- <div class="copyright wow fadeInLeft animated text-md-left " data-wow-duration="1s " data-wow-delay=".2s " style="visibility: visible; animation-duration: 1s; animation-delay: 0.2s; "> -->
                    <div class="col-12 col-md-8 flex flex-column ">
                        <p style="color: white; ">This independent <span style="color: #e62b1e; ">TEDx</span> event is operated under license from <span style="color: #e62b1e; ">TED</span>.</p>
                        <p style="color: white; "><span style="color: #e62b1e; ">TEDxVSSUT</span> is hosted by <span><a style="color: #e62b1e; font-weight: 400; " href="https://ecellvssut.tech/ ">E-Cell VSSUT</a></span>.</p>
                    </div>


                    <div class="col-12 col-md-4 footer-social ">
                        <ul class="social-media d-flex flex-wrap mb-0 p-0 justify-content-center justify-content-md-end ">
                            <li class="wow fadeInRight animated " data-wow-duration="1s " data-wow-delay=".5s " style="visibility: visible; animation-duration: 1s; animation-delay: 0.5s; "><a href="https://www.facebook.com/tedxvssut/ "><i class="fa-brands
                            fa-facebook-f "></i></a></li>
                            <li class="wow fadeInRight animated " data-wow-duration="1s " data-wow-delay=".4s " style="visibility: visible; animation-duration: 1s; animation-delay: 0.4s; "><a href="https://www.linkedin.com/company/tedxvssut/?originalSubdomain=in
                            "><i class="fab fa-linkedin-in "></i></a></li>
                            <li class="wow fadeInRight animated " data-wow-duration="1s " data-wow-delay=".3s " style="visibility: visible; animation-duration: 1s; animation-delay: 0.3s; "><a href="https://www.instagram.com/tedxvssut/ "><i class="fab
                            fa-instagram "></i></a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- footer section ending here -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js " integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p " crossorigin="anonymous "></script>
    <script>
        const back = document.querySelector('.back-button')

        back.addEventListener('click', (e) => {
            e.preventDefault();
            history.back();
        })
        const form = document.querySelector('form')
        const error = document.querySelector('#error')
        const payment_status = document.querySelector('#payment-status')
        const checkbtn = document.querySelector('#checkbtn')
        const uname = document.querySelector('#uname')
        const upaymentid = document.querySelector('#upaymentid')
        const status = document.querySelector('#status')
        const icon_paid = document.querySelector('#icon-paid')
        const icon_fail = document.querySelector('#icon-fail')


        const query = window.location.search
        const q_obj = new URLSearchParams(query)
        console.log(q_obj.get('user'))

        const loading = `<div class="spinner-border text-white" role="status">
            <span class="sr-only">Loading...</span>
          </div>`
        const notLoading = `Check`

        async function getUserStatus(url, payment_id) {
            const response = await fetch(url + payment_id)
            return response.json()
        }

        getUserStatus('https://api-tedxvssut.herokuapp.com/users/status/', q_obj.get('user'))
            .then(data => {
                console.log(data)
                checkbtn.innerHTML = notLoading
                if ('error' in data) {
                    error.innerHTML = data.message
                    error.classList.remove('d-none')
                } else {
                    uname.innerHTML = data.user.first_name + data.user.last_name
                    upaymentid.innerHTML = data.user.payment_id
                    if (data.user.is_registered) {
                        icon_paid.classList.remove('d-none')
                        icon_fail.classList.add('d-none')
                    } else {
                        icon_paid.classList.add('d-none')
                        icon_fail.classList.remove('d-none')
                    }
                    payment_status.classList.remove('d-none')
                    error.classList.add('d-none')
                }
            })

        form.addEventListener('submit', (e) => {
            checkbtn.innerHTML = loading
            e.preventDefault()
            console.log(form.payid.value)
            const payment_id = form.payid.value
            getUserStatus('https://api-tedxvssut.herokuapp.com/users/status/', payment_id)
                .then(data => {
                    console.log(data)
                    checkbtn.innerHTML = notLoading
                    if ('error' in data) {
                        error.innerHTML = data.message
                        error.classList.remove('d-none')
                    } else {
                        uname.innerHTML = data.user.first_name + data.user.last_name
                        upaymentid.innerHTML = data.user.payment_id
                        if (data.user.is_registered) {
                            icon_paid.classList.remove('d-none')
                            icon_fail.classList.add('d-none')
                        } else {
                            icon_paid.classList.add('d-none')
                            icon_fail.classList.remove('d-none')
                        }
                        payment_status.classList.remove('d-none')
                        error.classList.add('d-none')
                    }
                })

        })
    </script>
</body>

</html>

</html>